# 3. 인덱스 튜닝

## 3.1 테이블 액세스 최소화

- SQL 튜닝은 랜덤 IO와의 전쟁
- 많은 DBMS에서 성능 향상을 위해 랜덤 IO를 극복하기 위한 많은 튜닝 기법을 제공

### 3.1.1 테이블 랜덤 액세스

- ROWID는 테이블 레코드를 찾아가기 위한 논리적 주소
  - 쉽게 포인터와 비유되곤 하지만 물리적으로 0비용에 가깝게 데이터를 접근할 수 있는 포인터와는 다르다.
- 메인 메모리 DB(MMDB, 데이터를 모두 메모리에 로드)와의 차이점
  - 제대로 된 DB는 버퍼캐시 히트율이 99%라 거의 메모리만 읽는데 왜이렇게 속도차이가 나는가
    - 일반 오라클 DB는 직접적 포인터 연결이 아니라 테이블 블록이 수시로 버퍼캐시에 밀려나고 캐싱되는걸 반복하기 때문
    - 메모리주소정보(포인터)가 아닌 디스크주소정보(DBA, 데이터파일번호+블록번호)로 버퍼블록을 찾아간다.
      - 포인터는 전화번호, ROWID는 우편주소
- IO 매커니즘 복습
  - DBA는 디스크상에서 블록을 찾기 위한 주소정보
  - IO 성능을 높이려면 디스크가 아닌 버퍼캐시를 활용
    - 해싱 알고리즘으로 버퍼헤더를 찾고, 거기서 얻은 포인터로 버퍼블록을 찾음
  - 인덱스로 데이터 블록 액세스시 ROWID를 분해해서 DBA 정보를 얻고, Full Scan시 익스텐트 맵을 이용한다.
  - 데이터가 캐싱되어있어도 테이블 레코드를 찾기 위해 매번 DBA 해싱, 래치 획득 과정, Lock에 대한 비용을 지불해야함
  - 결론 : ROWID를 이용한 테이블 액세스는 생각보다 고비용구조

### 3.1.2 인덱스 클러스터링 팩터

- 개요 : CF. 군집성 계수.
  - 같은 값을 갖는 데이터가 서로 모여있는 정도
  - CF가 좋은 컬럼에 생성한 인덱스는 검색효율이 좋다.
    - 인덱스 레코드가 직전과 같은 테이블이면  
    래치 획득, 해시체인 스캔 과정을 생략하고 바로 데이터블록을 읽을 수 있기 때문
